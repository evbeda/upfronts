{% extends 'base.html' %}
{% load bootstrap4 %}
{% load static %}
{% bootstrap_css %}
{% load staticfiles %}
{% load i18n %}
{% block head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/create_condition.css' %}">
{% endblock %}

{% block title %} Create condition {% endblock title %}

{% block content %}
    <div class='m-5 p-3'>
        {% if messages %}
          <div class="alert alert-danger">
            {% for message in messages %}
              {{ message }}
            {% endfor %}
          </div>
        {% endif %}
        <div class="row justify-content-center m-3">
                <div class="card width-card">
                  <div class="card-body">
                    <h5 class="card-title">Installment</h5>
                    <p class="card-text">
                      <li class="m-2"> <b>Organizer: </b> {{ installment.contract.organizer_account_name }}</li>
                      <li class="m-2"> <b>Recoupable: </b> {{ installment.is_recoup }}</li>
                      <li class="m-2"> <b>Max payment date: </b> {{ installment.maximum_payment_date }}</li>
                      <li class="m-2"> <b>Upfront projection: </b> {{ installment.upfront_projection }}</li>
                      <li class="m-2"> <b>Recoup amount: </b> {{ installment.recoup_amount }}</li>
                      <li class="m-2"> <b>Status: </b> {{ installment.status }}</li>
                      <li class="m-2"> <b>GTF: </b> {{ installment.gtf }}</li>
                      <li class="m-2"> <b>GTS: </b> {{ installment.gts }}</li>
                    </p>
                  </div >
                </div>
        </div>
        <table class="table container">
          <tr>
            <th>Condition name</th>
            <th>Date modified</th>
            <th>Actions</th>
            <th>Preview</th>
            <th>Download</th>
            <th>Upload a File (.pdf, .xls, .png, .jpeg)</th>
            <th>Action</th>
          </tr>
          {% for object in object_list %}
          <tr>
            <td>{{ object.condition_name }}</td>
            <td>{% if object.done %}{{ object.done }} {% endif %}</td>
            <td>
              <form action="{% url 'toggle-condition' installment.contract_id installment.id object.id %}" method="POST">
                  {% csrf_token %}
                  <button class="btn btn-outline-primary" type="submit">
                    {% if object.done %}
                      Undo
                    {% else %}
                      Mark as Done
                    {% endif %}
                  </button>
              </form>
            </td>
            {% if object.upload_file %}
                <td>
                  <a target="_blank" href="http://docs.google.com/gview?url={{ object.upload_file.url }}"><i class="fas fa-search"></i></a>
                </td>
                <td>
                  <a href="{{ object.upload_file.url }}"><i class="fas fa-download"></i></a>
                </td>
                <td>
                  {{object.upload_file}}
                </td>
                <td>
                  <a href=""><i class="far fa-trash-alt"></i></a>
                </td>
                {% else %}
                <td>
                  <a><i class="fas fa-search"></i></a>
                </td>
                <td>
                  <a><i class="fas fa-download"></i></a>
                </td>
                <form enctype="multipart/form-data" method="POST" action="{% url 'condition_backup_proof' installment.contract_id installment.id object.id %}">
                  {% csrf_token %}
                  <td>
                    <input type="file" name="backup_file" accept="application/pdf, application/vnd.ms-excel, image/png, image/jpeg">
                  </td>
                  <td>
                    <input type="submit" value="Upload"/>
                  </td>
                  </form>
              {% endif %}
          </tr>
          {% endfor %}
        </table>
        <div class="row justify-content-center m-5">
            <div class="col-6">
                <form method="post">{% csrf_token %}
                    <div class="m-2">
                        <h2>Create condition</h2>
                    </div>
                    <div class="container">
                        {% bootstrap_form form layout='horizontal' %}
                        <div class="form-group row">
                            <div class="col-sm-10 offset-sm-2">
                                <div class="float-right">
                                    <input type='submit' class="btn btn-outline-primary" value='Save' />
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="float-left">
            <a href="{% url 'installments-create' installment.contract_id %}" role="button" class="btn btn-outline-secondary"><i class="far fa-arrow-alt-circle-left"></i>  Back</a>
        </div>
    </div>
{% endblock content %}
